<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXT-HUB | Secure Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ä»¥å‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ */
        :root {
            --bg-body: #0d0d0d;
            --bg-header: radial-gradient(circle at center, #1a1a1a 0%, #0d0d0d 100%);
            --bg-card: #181818;
            --bg-nav: rgba(13, 13, 13, 0.9);
            --bg-sidebar: #121212;
            --text-main: #ffffff;
            --text-sub: #a0a0a0;
            --border-color: #2c2c2c;
            --ai-purple: #8e44ad;
            --scratch-blue: #4d97ff;
            --like-color: #ff4757;
        }
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background-color: var(--bg-body); color: var(--text-main); margin:0; }
        nav { padding: 10px 5%; display: flex; justify-content: space-between; align-items: center; background: var(--bg-nav); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border-color); }
        .nav-left { display: flex; align-items: center; gap: 15px; }
        .logo { font-weight: 700; font-size: 1.2rem; }
        .container { max-width: 1200px; margin: 0 auto; padding: 30px 5%; }
        
        /* ãƒšãƒ¼ã‚¸åˆ¶å¾¡ */
        #home-radio, #news-radio, #ai-radio, #general-radio, #sidebar-check { display: none !important; }
        .page-content { display: none; }
        #home-radio:checked ~ .container #home-page,
        #ai-radio:checked ~ .container #ai-page { display: block; }

        /* APIã‚­ãƒ¼è¨­å®šã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .api-setting-banner {
            background: #2a1a3a;
            border: 1px solid var(--ai-purple);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .api-setting-banner input {
            background: #000;
            border: 1px solid #444;
            color: #fff;
            padding: 8px;
            border-radius: 5px;
            flex-grow: 1;
        }

        .chat-box { background: var(--bg-card); border-radius: 15px; border: 1px solid var(--border-color); height: 500px; display: flex; flex-direction: column; overflow: hidden; }
        #chat-msgs { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 85%; padding: 10px 15px; border-radius: 12px; }
        .msg.user { align-self: flex-end; background: var(--ai-purple); }
        .msg.bot { align-self: flex-start; background: #333; }
        .btn { padding: 8px 18px; border-radius: 6px; cursor: pointer; border: none; font-weight: 600; }
    </style>
</head>
<body>

    <input type="radio" name="page" id="home-radio" checked>
    <input type="radio" name="page" id="ai-radio">
    <input type="checkbox" id="sidebar-check">

    <nav>
        <div class="nav-left">
            <label for="sidebar-check" style="cursor:pointer;">â˜°</label>
            <div class="logo">NEXT-HUB</div>
        </div>
        <div style="display:flex; gap:15px;">
            <label for="home-radio" style="cursor:pointer;">HOME</label>
            <label for="ai-radio" style="cursor:pointer;">AI</label>
        </div>
    </nav>

    <main class="container">
        <div id="home-page" class="page-content">
            <h2>Scratch Projects</h2>
            <p>GitHub Pagesã§å…¬é–‹ã—ã¦ã‚‚å®‰å¿ƒãªè¨­å®šã§ã™ã€‚</p>
            </div>

        <div id="ai-page" class="page-content">
            <div class="api-setting-banner">
                <span>ğŸ”‘ OpenAI APIã‚­ãƒ¼ã‚’è¨­å®š:</span>
                <input type="password" id="user-sk-key" placeholder="sk-...">
                <button onclick="saveKey()" class="btn" style="background:#fff; color:#000;">ä¿å­˜</button>
                <small style="width:100%; color:var(--text-sub);">â€»ã‚­ãƒ¼ã¯GitHubã«é€ä¿¡ã•ã‚Œãšã€ã‚ãªãŸã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã®ã¿ã§åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚</small>
            </div>

            <div class="chat-box">
                <div id="chat-msgs"><div class="msg bot">APIã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹ã¨ãƒãƒ£ãƒƒãƒˆãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</div></div>
                <div style="padding:15px; background:#111; display:flex; gap:10px;">
                    <input type="text" id="ai-in" style="flex-grow:1; background:#000; border:1px solid #333; color:#fff; padding:10px; border-radius:8px;" placeholder="AIã«è³ªå•...">
                    <button onclick="askAI()" class="btn" style="background:var(--ai-purple); color:white;">é€ä¿¡</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- APIã‚­ãƒ¼ç®¡ç† ---
        let currentApiKey = "";

        function saveKey() {
            const keyInput = document.getElementById('user-sk-key').value.trim();
            if (keyInput.startsWith("sk-")) {
                currentApiKey = keyInput;
                alert("ã‚­ãƒ¼ã‚’ä¸€æ™‚ä¿å­˜ã—ã¾ã—ãŸã€‚ãƒãƒ£ãƒƒãƒˆãŒå¯èƒ½ã§ã™ã€‚");
                document.getElementById('user-sk-key').value = "********"; // éš ã™
            } else {
                alert("æ­£ã—ã„APIã‚­ãƒ¼ï¼ˆsk-ã§å§‹ã¾ã‚‹ã‚‚ã®ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            }
        }

        async function askAI() {
            if (!currentApiKey) {
                alert("å…ˆã«APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚");
                return;
            }
            const input = document.getElementById('ai-in');
            const box = document.getElementById('chat-msgs');
            const txt = input.value.trim();
            if(!txt) return;

            box.innerHTML += `<div class="msg user">${txt}</div>`;
            input.value = '';

            try {
                const res = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: { 
                        "Content-Type": "application/json", 
                        "Authorization": `Bearer ${currentApiKey}` 
                    },
                    body: JSON.stringify({ model: "gpt-4o-mini", messages: [{ role: "user", content: txt }] })
                });
                const d = await res.json();
                box.innerHTML += `<div class="msg bot">${d.choices[0].message.content}</div>`;
            } catch(e) {
                box.innerHTML += `<div class="msg bot" style="color:red;">ã‚¨ãƒ©ãƒ¼ï¼šã‚­ãƒ¼ãŒç„¡åŠ¹ã‹ã€é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div>`;
            }
            box.scrollTop = box.scrollHeight;
        }

        // ã„ã„ã­æ©Ÿèƒ½ (localStorage)
        let likes = parseInt(localStorage.getItem('next_hub_likes')) || 0;
        // (ä»¥å‰ã®ã„ã„ã­æ•°è¡¨ç¤ºå‡¦ç†ãªã©ã‚’è¿½åŠ )
    </script>
</body>
</html>
